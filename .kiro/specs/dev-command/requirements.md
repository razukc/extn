# Requirements Document

## Introduction

This feature adds development workflow capabilities to projects generated by the extn CLI. When developers run `npm run dev` in their generated project, it automatically launches a browser with the Chrome extension loaded, enabling rapid development with auto-reload capabilities. This eliminates the manual "load unpacked" workflow and provides a seamless development experience similar to web-ext and WXT framework.

The implementation involves updating the project templates to include web-ext as a dependency and configuring the dev script to use web-ext for browser automation, while leveraging Vite and @crxjs/vite-plugin for the build and HMR capabilities.

## Glossary

- **Dev Script**: The npm script (`npm run dev`) in generated projects that starts the development workflow
- **Generated Project**: A Chrome extension project created by running `extn create`
- **Project Template**: The template files used by extn CLI to scaffold new projects
- **web-ext**: Mozilla's command-line tool for building and testing web extensions (added as dependency to generated projects)
- **Vite Dev Server**: Vite's development server with built-in HMR capabilities (already configured in templates)
- **Vite HMR**: Vite's Hot Module Replacement system that updates modules without full page reload
- **@crxjs/vite-plugin**: Vite plugin that provides Chrome extension-specific build and HMR capabilities (already in templates)
- **User Data Directory**: Browser profile directory containing settings, extensions, and user data
- **Extension Context**: The isolated environment where Chrome extensions run
- **HMR (Hot Module Replacement)**: Technology that updates modules in a running application without full reload

## Requirements

### Requirement 1

**User Story:** As a developer, I want to run a single command to start development, so that I can quickly begin working on my extension without manual setup

#### Acceptance Criteria

1. WHEN a developer runs `npm run dev`, THE Dev Command SHALL start the Vite development server
2. WHEN the initial build completes, THE Browser Launcher SHALL automatically open a browser with the extension loaded
3. THE Dev Command SHALL display clear status messages for each step of the startup process
4. THE Dev Command SHALL complete the entire startup sequence within 10 seconds on a standard development machine
5. IF any step fails, THEN THE Dev Command SHALL display a helpful error message and exit gracefully

### Requirement 2

**User Story:** As a developer, I want the browser to launch with my extension loaded, so that I can immediately test my changes

#### Acceptance Criteria

1. THE Browser Launcher SHALL use web-ext to launch the browser with the extension loaded
2. THE Browser Launcher SHALL use a temporary browser profile by default (web-ext default behavior)
3. THE Browser Launcher SHALL open the chrome://extensions page on startup for easy debugging
4. THE Browser Launcher SHALL allow developers to customize browser launch options via web-ext-config.mjs
5. IF the browser fails to launch, THEN THE Browser Launcher SHALL display a helpful error message

### Requirement 3

**User Story:** As a developer, I want the extension to automatically reload when I make changes, so that I can see my updates immediately without manual intervention

#### Acceptance Criteria

1. THE Dev Command SHALL leverage Vite's HMR API for hot module replacement in extension pages
2. THE Auto-Reload System SHALL use @crxjs/vite-plugin's built-in extension reload capabilities
3. WHEN popup, options, or content script files change, THE Vite HMR SHALL update them without full extension reload
4. WHEN manifest or background service worker changes, THE Auto-Reload System SHALL perform a full extension reload
5. THE Auto-Reload System SHALL preserve the current browser tab and navigation state during HMR updates

### Requirement 4

**User Story:** As a developer, I want to choose which browser to use for development, so that I can test my extension in my preferred browser

#### Acceptance Criteria

1. THE Browser Launcher SHALL support Chrome/Chromium as the default browser
2. THE Browser Launcher SHALL support Firefox when specified via `--browser firefox` option
3. THE Browser Launcher SHALL support Edge when specified via `--browser edge` option
4. THE Browser Launcher SHALL detect the browser binary automatically on Windows, macOS, and Linux
5. THE Browser Launcher SHALL allow developers to specify a custom browser binary path via configuration

### Requirement 5

**User Story:** As a developer, I want the browser to open with developer tools ready, so that I can immediately debug my extension

#### Acceptance Criteria

1. WHEN the browser launches, THE Browser Launcher SHALL automatically open Chrome DevTools
2. THE Browser Launcher SHALL navigate to the extension management page (`chrome://extensions`) on startup
3. THE Browser Launcher SHALL enable extension developer mode automatically
4. THE Browser Launcher SHALL display the extension's background page console if available
5. THE Browser Launcher SHALL allow developers to disable auto-opening DevTools via command-line option

### Requirement 6

**User Story:** As a developer, I want clear feedback about the development server status, so that I know when the system is ready for development

#### Acceptance Criteria

1. THE Dev Command SHALL display the Vite dev server URL when it starts
2. THE Dev Command SHALL display the browser type and version being launched
3. THE Dev Command SHALL display the profile directory location
4. THE Dev Command SHALL display a "Ready for development" message when all systems are running
5. THE Dev Command SHALL display file change notifications when the extension reloads

### Requirement 7

**User Story:** As a developer, I want to cleanly stop the development server, so that browser processes don't remain running in the background

#### Acceptance Criteria

1. WHEN the developer presses Ctrl+C, THE Dev Command SHALL gracefully shut down the Vite server
2. THE Dev Command SHALL close the browser instance when shutting down
3. THE Dev Command SHALL save the browser profile state before closing
4. THE Dev Command SHALL clean up any temporary files created during the session
5. THE Dev Command SHALL complete the shutdown process within 3 seconds

### Requirement 8

**User Story:** As a developer, I want the dev script to work with the existing Vite setup, so that I don't need to change my build configuration

#### Acceptance Criteria

1. THE Dev Script SHALL use the existing `vite.config.js` configuration in the generated project
2. THE Dev Script SHALL leverage @crxjs/vite-plugin's HMR capabilities for extension hot reload
3. THE Dev Script SHALL respect the existing build output directory (`dist`)
4. THE Dev Script SHALL integrate seamlessly with the existing template structure
5. THE Dev Script SHALL run Vite dev server and web-ext concurrently

### Requirement 9

**User Story:** As a developer, I want to configure development server options, so that I can customize the behavior for my workflow

#### Acceptance Criteria

1. THE Generated Project SHALL support web-ext configuration via `web-ext-config.js` file
2. THE Generated Project SHALL allow specifying browser target via web-ext configuration
3. THE Generated Project SHALL allow specifying custom profile directory via web-ext configuration
4. THE Generated Project SHALL allow configuring browser launch options via web-ext configuration
5. THE Generated Project SHALL support Vite configuration via existing `vite.config.js`

### Requirement 10

**User Story:** As a developer, I want the dev script to use Vite's development capabilities, so that I get fast HMR and optimal development experience

#### Acceptance Criteria

1. THE Dev Script SHALL run Vite dev server using the `vite` command
2. THE Vite Configuration SHALL serve the extension files with proper CORS headers via @crxjs/vite-plugin
3. THE @crxjs/vite-plugin SHALL utilize WebSocket connection for extension communication and HMR
4. THE Dev Script SHALL display Vite's build output and HMR notifications in the console
5. THE Generated Project SHALL support Vite's configuration options via `vite.config.js`

### Requirement 11

**User Story:** As a developer, I want helpful error messages when something goes wrong, so that I can quickly resolve issues

#### Acceptance Criteria

1. IF the browser binary is not found, THEN web-ext SHALL display installation instructions
2. IF the build fails, THEN Vite SHALL display the build error with file location
3. IF the port is already in use, THEN Vite SHALL suggest an alternative port
4. IF the extension manifest is invalid, THEN @crxjs/vite-plugin SHALL display validation errors
5. THE Generated Project README SHALL include troubleshooting documentation for common issues
